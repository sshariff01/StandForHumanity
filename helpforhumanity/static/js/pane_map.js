octoplace_com.m.main.loadModules(["data","util"],function(){octoplace_com.m.pane_map=function(){function u(){var e=new google.maps.LatLng(h.default_lat,h.default_lng);h.location=e;e={backgroundColor:"#7aa5b4",center:e,zoom:h.min_zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,minZoom:h.min_zoom,panControl:!1,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},zoomControl:!1,styles:[{featureType:"water",elementType:"geometry",stylers:[{color:"#7aa5b4"}]},
{featureType:"poi",stylers:[{visibility:"off"}]}]};h.map=new google.maps.Map($("#pane_map_canvas")[0],e);n.init(h.map);b.m.pane_map.Autocomplete.init();b.m.pane_map.Places.init();var f=google.maps.event.addListener(h.map,"tilesloaded",function(){google.maps.event.removeListener(f);$(m).removeClass("loading");b.m.pane_map.resize()}),k=google.maps.event.addListener(h.map,"zoom_changed",function(){google.maps.event.removeListener(k);h.zoom_changed=!0}),c=google.maps.event.addListener(h.map,"center_changed",
function(){google.maps.event.removeListener(c);h.center_changed=!0});r.init();var s=h.map.getStreetView();google.maps.event.addListener(s,"visible_changed",function(a){s.getVisible()?$("body").addClass("map_street_view_shown"):$("body").removeClass("map_street_view_shown")});google.maps.event.addListener(h.map,"click",function(a){if(!$("body").is(".bookmarklet_is_saving_place")&&$("body").is(".place_picker_mode")){var c=a.latLng.lat();a=a.latLng.lng();b.m.pane_map.dropAPin({lat:c,lng:a})}});t()}function t(){"visible"==
$(m).css("visibility")?b.m.pane_map.resize():setTimeout(function(){t()},17)}function q(){return"undefined"!=typeof google&&google.maps&&h.map?!0:!1}function v(){window.octoplace_com_google_maps_init_load=function(){u();$(document).trigger("octoplace_com_google_maps_loaded")};var b=$("<script>");$(b).attr("src","//maps.googleapis.com/maps/api/js?v="+h.version+"&libraries=places&key="+h.api_key+"&sensor=false&callback=octoplace_com_google_maps_init_load");document.body.appendChild(b[0])}var b=octoplace_com,
l={};b.m.main.loadCss("pane_map");var m=b.m.main.makePane("pane_map"),h={api_key:octoplace_com_config.google_maps_api_key,cluster_zoom:12,default_lat:11.837351,default_lng:-81.017763,default_static_map_zoom:15,ideal_zoom:15,location:{},min_zoom:3,search_radius:250,version:octoplace_com_config.google_maps_version,zoom_changed:!1,center_changed:!1};l.Autocomplete=function(){function b(a,c){var d=$('<div class="suggestions google_place_autocomplete kb_nav_item_set"></div>');if(0==a.length)$(d).append('<div class="zero_results">No popular results. Try loading more.</div>');
else for(var g=0;g<a.length;g++)$(d).append(f(a[g],c[g]));return d}function f(a,b){var c=$('<div class="suggestion google_place_autocomplete kb_nav_item"></div>');$(c).append(a);$(c).find(".pac-icon").remove();$(c).find(".pac-matched").addClass("query_text_match").removeClass("pac-matched");var g=$(c).find(".pac-item-query").first();$(g).addClass("place_name").removeClass("pac-item-query");var e=$('<span class="inline_separator">, </span>');$(g).after(e);g=$(c).find(".pac-item-location").first();
$(g).addClass("place_address").removeClass("pac-item-location");$(c).prepend('<div class="icon"></div>');g=$(e).next();0!=g.length&&""!=$(g).html()||$(e).remove();var f=function(a){a.preventDefault();$(d.autocomplete_input).trigger("focus");k(b,"mouseover");k(b,"mousedown");$(d.autocomplete_input).trigger("blur")};$(c).on("mousedown",f);$(c).on("mouseup",function(a){a.preventDefault();$(c).off("mousedown");setTimeout(function(){$(c).on("mousedown",f)},1E3)});return c}function k(a,c){var b=document.createEvent("MouseEvents");
b.initMouseEvent(c,!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(b)}var c=!1,h=null,a={},p=0,g={},d={};g.bind=function(d,f,k){g.release();c=!0;h=d;google.maps.event.clearListeners(a,"place_changed");google.maps.event.addListener(a,"place_changed",function(){var c=a.getPlace();f(c)});var l=["foo_bar"],m=[];clearInterval(p);p=setInterval(function(){var a=[],c=[];$(".pac-container").children().each(function(){a.push($(this).html());c.push(this)});if(0!=$(l).not(a).length||0!=$(a).not(l).length)l=
a,m=c,k(b(a,c));else if(0<m.length){var d=m[0].parentNode;if("undefined"==typeof d||null==d)k(b(a,c)),m=c}},17)};g.create=function(){d.autocomplete_input=$('<input type="text" id="place_name_autocomplete">');$(d.autocomplete_input).css({position:"fixed",top:"0px",left:"-999px",width:"800px",border:"none"});$("body").append(d.autocomplete_input)};g.getInputField=function(){return d.autocomplete_input};g.init=function(){var c=$(d.autocomplete_input)[0];a=new google.maps.places.Autocomplete(c)};g.isBoundTo=
function(a){return $(a).is(h)};g.release=function(){c&&(c=!1,h=null,clearInterval(p),google.maps.event.clearListeners(a,"place_changed"),$(d.autocomplete_input).val(""))};g.search=function(a){$(d.autocomplete_input).val(a);a=document.activeElement;$(d.autocomplete_input).trigger("focus");$(a).trigger("focus")};return g}();l.clearAllMarkers=function(){n.hideSummary();n.hideLabel();b.m.pane_map.clearDroppedPin();b.m.pane_map.clearFocusMarkers();b.m.pane_map.clearOtherMarkers();b.m.pane_map.clearUserMarkers();
b.m.pane_map.clearLoggedInUserMarkers()};l.clearDroppedPin=function(){n.clearDroppedPin()};l.clearFocusMarkers=function(){n.clearPins(["focus"])};l.clearOtherMarkers=function(){n.clearPins(["other"])};l.clearUserMarkers=function(){n.clearPins(["user"])};l.clearLoggedInUserMarkers=function(){n.clearPins(["logged_in_user"])};l.create=function(){b.m.pane_map.MapPanelControls.init();$(m).addClass("loading");b.m.pane_map.expand();$(m).append('<div id="pane_map_canvas_container"><div id="pane_map_canvas"></div></div>');
$("body").append(m);b.m.pane_map.Autocomplete.create();v()};var r=function(){var e={},f={nextCallback:null};e.init=function(){google.maps.event.addListener(h.map,"center_changed",function(){var e=b.m.pane_map.getCenter();"function"==typeof f.nextCallback&&(f.nextCallback(e.lat(),e.lng()),f.nextCallback=null)})};e.setNextCallback=function(b){f.nextCallback=b};return e}();l.createClusterMarker=function(e,f){b.m.pane_map.createMarker(e,f)};l.createMarker=function(b,f){"undefined"==typeof f&&(f={});n.showPlacePin(b,
f)};l.contract=function(){$("body").is(".map_expanded")&&$("body").removeClass("map_expanded")};l.doAfterMapLoad=function(e){if(q())e();else{var f=b.m.util.generateUniqueId();$(document).one("octoplace_com_google_maps_loaded."+f,function(){e()})}};l.dropAPin=function(b){n.dropAPin(b)};l.expand=function(){$("body").is(".map_expanded")||$("body").addClass("map_expanded");b.m.pane_map.doAfterMapLoad(function(){b.m.pane_map.resize()})};l.formatForHomePage=function(e){var f={},k=null,c=null,h=null,a=0,
p=0;f.reposition=function(){var a=$(window).scrollTop();if(c!=a){c=a;var b=$(e).offset().top;a>=b-60?($(m).css("top","60px"),h=60,$(m).css("position","fixed")):h!=b&&($(m).css("position",""),$(m).css("top",b+"px"),h=b)}};f.resize=function(){var a=$(window).height()-60;k!=a&&(k=a,$(m).css("height",a+"px"),b.m.pane_map.resize())};$("body").is(".map_home_page")||$("body").addClass("map_home_page");b.m.pane_map.hide();f.resize();f.reposition();$(window).off("resize.map_home_page");$(window).on("resize.map_home_page",
function(b){a||(a=setTimeout(function(){f.resize();a=0},100))});$(window).off("scroll.map_home_page");$(window).on("scroll.map_home_page",function(a){p||(p=setTimeout(function(){f.reposition();p=0},17))})};l.formatReset=function(){$("body").is(".map_home_page")&&$("body").removeClass("map_home_page");$(m).css("height","");$(m).css("top","");$(m).css("position","");$(window).off("resize.map_home_page");$(window).off("scroll.map_home_page")};l.fitBounds=function(e,f,k){b.m.pane_map.doAfterMapLoad(function(){var c=
new google.maps.LatLng(e.lat,e.lng),l=new google.maps.LatLng(f.lat,f.lng),c=new google.maps.LatLngBounds(c,l);b.m.pane_map.zoomInToDefault();if("function"==typeof k){var a=!1,p=function(){a||(a=!0,google.maps.event.removeListener(g),k())},g=google.maps.event.addListener(h.map,"bounds_changed",function(){p()});setTimeout(function(){p()},500)}h.map.fitBounds(c)})};l.fitBoundsToPlaceIds=function(e){for(var f={fit:function(){for(var a={lat:c[0].lat-k,lng:c[0].lng-k},e={lat:c[0].lat+k,lng:c[0].lng+k},
g=1;g<c.length;g++){var d=c[g];d.lat>e.lat&&(e.lat=d.lat);d.lng>e.lng&&(e.lng=d.lng);d.lat<a.lat&&(a.lat=d.lat);d.lng<a.lng&&(a.lng=d.lng)}b.m.pane_map.fitBounds(a,e,function(){f.pan()})},pan:function(){var a=h.map.getBounds();if(a){for(var e=!0,g=0;g<c.length;g++){var d=c[g],d=new google.maps.LatLng(d.lat,d.lng);if(a.contains(d)){e=!1;break}}e&&b.m.pane_map.panTo(c[0].lat,c[0].lng)}}},k=0.005,c=[],l=0;l<e.length;l++)c.push(b.m.shared.getLatLngFromPlaceId(e[l]));1<c.length?h.zoom_changed||h.center_changed?
f.pan():f.fit():1==c.length&&b.m.pane_map.panTo(c[0].lat,c[0].lng)};l.getCenter=function(){var b=h.map.getCenter();return new google.maps.LatLng(b.lat(),b.lng())};l.getHeight=function(){return $(m).height()};l.hide=function(){$("body").is(".hide_map")||$("body").addClass("hide_map")};l.isHidden=function(){return $("body").is(".hide_map")?!0:!1};l.makeStaticMap=function(b,f){if(!b||!f)return!1;var k=b+","+f,c=$('<a href="https://maps.google.com/maps?q='+k+'" target="_blank"></a>');$(c).addClass("static_map_link");
$(c).attr("title","Open map in new window");try{var l=encodeURIComponent("color:0xff3333|"+k)}catch(a){return!1}k=$('<img class="static_map">');$(k).attr("src","//maps.googleapis.com/maps/api/staticmap?size=228x128&zoom="+h.default_static_map_zoom+"&markers="+l+"&sensor=false&key="+h.api_key);$(c).append(k);return c};l.MapPanelControls=function(){var e={status:{initialized:!1}},f,k,c,l,a,p,g,d={init:function(){e.status.initialized||(e.status.initialized=!0,f=$('<div class="map_show"></div>'),$(m).append(f),
$(f).on("click",function(a){b.m.pane_map.expand()}),k=$('<div class="map_control map_type_toggle"><div class="icon"></div></div>'),$(m).append(k),$(k).on("click",function(a){a.preventDefault();d.toggleMapType()}),c=$('<div class="map_control map_zoom_in"><div class="icon"></div></div>'),$(m).append(c),$(c).on("click",function(a){a.preventDefault();d.zoomIn()}),l=$('<div class="map_control map_zoom_out"><div class="icon"></div></div>'),$(m).append(l),$(l).on("click",function(a){a.preventDefault();
d.zoomOut()}),a=$('<div class="map_control map_find_me"><div class="icon"></div></div>'),p=b.m.main.Loading.makeBlink(),$(p).addClass("black"),$(a).prepend(p),$(m).append(a),$(a).on("click",function(a){a.preventDefault();d.findMe()}),g=$('<div class="map_control map_contract"><div class="icon"></div></div>'),$(m).append(g),$(g).on("click",function(a){a.preventDefault();b.m.pane_map.contract();b.logged_in_user.user_id?ga("send","event","Button","Click","Map-Contract"):ga("send","event","Button","Click",
"Map-Contract-NotLoggedIn")}))},findMe:function(){if(!navigator.geolocation)return b.m.main.makeSignPost("Geolocation not supported by your device.");if(!$(a).is(".locating_in_progress")){$(a).addClass("locating_in_progress");var c=null,d="Looks like you clicked the <strong>Find Me</strong> button but haven't given us permission to see your location. There should be a security message at the top or bottom of your browser. Click the <strong>Allow</strong> button in that message. If you need help, email "+
b.m.shared.help_email+".";navigator.geolocation.getCurrentPosition(function(d){$("body").is(".place_picker_mode")?b.m.pane_map.panZoomThenDropPin({lat:d.coords.latitude,lng:d.coords.longitude}):b.m.pane_map.showMarker({lat:d.coords.latitude,lng:d.coords.longitude},{focus_marker:!0});clearTimeout(e.permission_timeout);$(c).remove();$(a).removeClass("locating_in_progress")},function(g){clearTimeout(e.permission_timeout);$(c).remove();1==g.code?b.m.main.makeSignPost(d):2==g.code?b.m.main.makeSignPost("Looks like your device wasn't able to locate you :(<br>Maybe you can try again when you have a stronger data signal."):
3==g.code&&b.m.main.makeSignPost("Looks like your device is taking longer than 10 seconds to find itself :(<br>Maybe you can try again when you have a stronger data signal.");$(a).removeClass("locating_in_progress")},{enableHighAccuracy:!0,maximumAge:0,timeout:1E4});clearTimeout(e.permission_timeout);e.permission_timeout=setTimeout(function(){c=b.m.main.makeSignPost(d);$(a).removeClass("locating_in_progress")},1E4)}},hide:function(){$(g).addClass("hidden");$(k).addClass("hidden");$(c).addClass("hidden");
$(l).addClass("hidden");$(a).addClass("hidden")},show:function(){$(g).removeClass("hidden");$(k).removeClass("hidden");$(c).removeClass("hidden");$(l).removeClass("hidden");$(a).removeClass("hidden")},toggleMapType:function(){h.map.getMapTypeId()==google.maps.MapTypeId.ROADMAP?(h.map.setMapTypeId(google.maps.MapTypeId.HYBRID),$(k).addClass("map_type_road")):(h.map.setMapTypeId(google.maps.MapTypeId.ROADMAP),$(k).removeClass("map_type_road"));b.logged_in_user.user_id?ga("send","event","Button","Click",
"Map-Type-Toggle"):ga("send","event","Button","Click","Map-Type-Toggle-NotLoggedIn")},zoomIn:function(){b.m.pane_map.doAfterMapLoad(function(){var a=h.map.getZoom();h.map.setZoom(a+1)})},zoomOut:function(){b.m.pane_map.doAfterMapLoad(function(){var a=h.map.getZoom();h.map.setZoom(a-1)})}};return d}();var n=function(){function e(){f.prototype=new google.maps.OverlayView;f.prototype.onAdd=function(){var a=document.createElement("div");a.style.position="absolute";a.style.visibility="hidden";this.div_=
a;a=function(a){a.stopPropagation()};this.listener_mousedown_=google.maps.event.addDomListener(this.div_,"mousedown",a);this.listener_click_=google.maps.event.addDomListener(this.div_,"click",a);this.listener_dblclick_=google.maps.event.addDomListener(this.div_,"dblclick",a);this.listener_contextmenu_=google.maps.event.addDomListener(this.div_,"contextmenu",a);this.listener_mouseover_=google.maps.event.addDomListener(this.div_,"mouseover",function(){c.mouse_is_over_label=!0});this.listener_mouseout_=
google.maps.event.addDomListener(this.div_,"mouseout",function(){c.mouse_is_over_label=!1});this.getPanes().floatPane.appendChild(this.div_)};f.prototype.draw=function(){if(this.position_&&this.getProjection()){var a=this.getProjection().fromLatLngToDivPixel(this.position_),b=Math.floor($(this.div_).width()/2),g=$(this.div_).height();this.div_.style.left=a.x-b+"px";this.div_.style.top=a.y-c.marker_height-c.triangle_height-c.label_marker_margin-g+"px"}};f.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),
this.div_=null);this.listener_mousedown_&&(google.maps.event.removeListener(this.listener_mousedown_),google.maps.event.removeListener(this.listener_click_),google.maps.event.removeListener(this.listener_dblclick_),google.maps.event.removeListener(this.listener_contextmenu_),google.maps.event.removeListener(this.listener_mouseover_),google.maps.event.removeListener(this.listener_mouseout_),this.listener_mouseout_=this.listener_mouseover_=this.listener_contextmenu_=this.listener_dblclick_=this.listener_click_=
this.listener_mousedown_=null)};f.prototype.show=function(a,b){this.content_=a;if(this.div_){if("undefined"===typeof this.content_.nodeType)this.div_.innerHTML=this.content_;else{for(var c=this.div_;c.hasChildNodes();)c.removeChild(c.firstChild);this.div_.appendChild(this.content_)}this.position_=b.getPosition();this.draw();this.div_.style.visibility="visible"}};f.prototype.hide=function(){this.div_&&this.div_.style&&(this.div_.style.visibility="hidden")}}function f(a){this.map_=c.map;this.zIndex_=
a;this.listener_mouseout_=this.listener_mouseover_=this.listener_contextmenu_=this.listener_dblclick_=this.listener_click_=this.listener_mousedown_=this.content_=this.div_=this.position_=null;this.setMap(c.map)}var k={},c={label_marker_margin:7,label_zIndex:10,drop_a_pin_marker:null,map:null,marker_width:22,marker_height:28,marker_dot_anchor_x:12,marker_dot_anchor_y:14,mouse_is_over_label:!1,pin_id:1,pin_queue:{},pins:{focus:[],other:[],user:[],logged_in_user:[]},summary_pin_id:null,triangle_height:8},
h=null;for(pin_set in c.pins)c.pin_queue[pin_set]=[];k.clearDroppedPin=function(){c.drop_a_pin_marker&&(c.drop_a_pin_marker.setMap(null),c.drop_a_pin_marker=null)};k.clearMarkers=function(a){for(var b=0;b<a.length;b++){var g=a[b];g.pin_id==c.summary_pin_id&&k.hideSummary();g.marker.setMap(null)}};k.clearPins=function(a){var b={clearMarkerSet:function(a){k.clearMarkers(c.pins[a]);c.pins[a]=[]}};if(a)for(var g=0;g<a.length;g++)b.clearMarkerSet(a[g]);else for(pin_set in c.pins)b.clearMarkerSet(pin_set)};
k.dropAPin=function(a){var e={},g=a,d=c.pin_id++;g.lat&&g.lng?q()&&(e.showSummary=function(){$("body").is(".bookmarklet_is_saving_place")||k.showPlaceSummary(g,d)},k.clearDroppedPin(),a={draggable:!0,icon:{url:b.sprite_path,size:new google.maps.Size(c.marker_width,c.marker_height),anchor:new google.maps.Point(c.marker_width/2,c.marker_height),origin:new google.maps.Point(529,285)},map:c.map,position:new google.maps.LatLng(g.lat,g.lng),shape:{coord:[c.marker_width/2,c.marker_width/2,c.marker_width/
2],type:"circle"},zIndex:1},a=new google.maps.Marker(a),c.drop_a_pin_marker=a,e.showSummary(),google.maps.event.addListener(a,"dragstart",function(a){g={lat:g.lat,lng:g.lng}}),google.maps.event.addListener(a,"dragend",function(a){g.lat=a.latLng.lat();g.lng=a.latLng.lng();e.showSummary()}),google.maps.event.addListener(a,"click",function(a){e.showSummary()})):b.log("No lat, lng provided for marker.")};k.showLabel=function(a,c,g){g||(g={});var d,e,f;d=$('<div class="marker_label"></div>');e=$('<div class="label_wrapper"></div>');
$(d).append(e);$(e).append(a);a=$('<div class="triangle"></div>');$(d).append(a);h.show(d[0],c);g.target_user_id?b.m.data.Cache.read.user(g.target_user_id,function(a,b){!a&&b.username&&($(d).addClass("has_help_text"),f=$('<div class="label_help_text"></div>'),$(f).append(b.username),$(d).prepend(f))}):g.help_text&&($(d).addClass("has_help_text"),c=$('<div class="label_help_text"></div>'),$(c).append(g.help_text),$(d).prepend(c))};k.showPlacePin=function(a,e){if(a.place_id||a.lat&&a.lng){var g={pin_id:c.pin_id++,
place_data:a,pin_options:e};if(q()){var d=c.pins.other;e.user_marker?d=c.pins.user:e.logged_in_user_marker?d=c.pins.logged_in_user:e.focus_marker&&(d=c.pins.focus);if(a.place_id)for(var f=0;f<d.length;f++)if(a.place_id==d[f].place_data.place_id)return;var f={map:c.map},k={};a.place_id?k=b.m.shared.getLatLngFromPlaceId(a.place_id):a.lat&&a.lng&&(k.lat=a.lat,k.lng=a.lng);f.position=new google.maps.LatLng(k.lat,k.lng);k={url:b.sprite_path,size:new google.maps.Size(c.marker_width,c.marker_height),anchor:new google.maps.Point(c.marker_width/
2,c.marker_height)};e.user_marker?(k.origin=b.logged_in_user.user_id==b.state.user_id_in_context?new google.maps.Point(409,289):new google.maps.Point(409,329),f.zIndex=3,k.anchor=new google.maps.Point(c.marker_dot_anchor_x,c.marker_dot_anchor_y)):e.logged_in_user_marker?(k.origin=new google.maps.Point(409,289),f.zIndex=2,k.anchor=new google.maps.Point(c.marker_dot_anchor_x,c.marker_dot_anchor_y)):e.focus_marker?(k.origin=new google.maps.Point(449,285),f.zIndex=5):(k.origin=b.logged_in_user.user_id==
b.state.user_id_in_context?new google.maps.Point(489,285):new google.maps.Point(489,369),f.zIndex=4);f.icon=k;f.shape={coord:[c.marker_width/2,c.marker_width/2,c.marker_width/2],type:"circle"};var h=new google.maps.Marker(f);g.marker=h;d.push(g);e.show_summary&&(a.place_id?b.m.data.Cache.read.place(a.place_id,function(a,c){if(a)return b.logE(a);c.null_result||(g.place_data=c);n.showPlaceSummary(g.place_data,g.pin_id,e)}):n.showPlaceSummary(g.place_data,g.pin_id,e));g.place_data.place_id?(google.maps.event.addListener(h,
"click",function(){$("body").is(".bookmarklet_is_saving_place")||(n.hideLabel(),n.showPlaceSummary(g.place_data,g.pin_id,e))}),google.maps.event.addListener(h,"mouseover",function(a){c.mouse_is_over_label||(a="",a=g.place_data.name?b.m.shared.prettyPlaceNameHTML(g.place_data):b.m.shared.extractPlaceNameHTML(g.place_data.place_id),n.showLabel(a,h,{target_user_id:e.target_user_id}))})):g.place_data.name&&(google.maps.event.addListener(h,"click",function(){$("body").is(".bookmarklet_is_saving_place")||
(n.hideLabel(),n.showPlaceSummary(g.place_data,g.pin_id,e))}),google.maps.event.addListener(h,"mouseover",function(d){c.mouse_is_over_label||n.showLabel(b.m.shared.prettyPlaceNameHTML(a),h)}));(g.place_data.place_id||g.place_data.name)&&google.maps.event.addListener(h,"mouseout",function(){n.hideLabel()})}else d=c.pin_queue.other,e.user_marker?d=c.pin_queue.user:e.logged_in_user_marker?d=c.pin_queue.logged_in_user:e.focus_marker&&(d=c.pin_queue.focus),d.push(g)}else b.log("No latLng provided for marker.")};
k.showPlaceSummary=function(a,e,f){f||(f={});var d={},h={fillSummary:function(a){$(d.summary_container).empty();d.heading_for_naming_place=$('<div class="heading_for_naming_place">Name this place.</div>');$(d.summary_container).append(d.heading_for_naming_place);if(a.name||a.place_id){if(a.place_id){d.place_name=$('<a class="state_trigger place_name" target="_blank"></a>');var c=f.target_user_id?b.m.shared.PathApp(["users",f.target_user_id,"places",a.place_id]):b.m.shared.PathApp(["places",a.place_id]);
$(d.place_name).attr("href",c)}else d.place_name=$('<div class="place_name"></div>');$(d.place_name).append(b.m.shared.prettyPlaceNameHTML(a));$(d.summary_container).append(d.place_name)}d.place_address=b.m.main.makePlaceAddressSummary(a);$(d.summary_container).append(d.place_address);$("body").is(".place_picker_mode")&&(d.map_it_wrapper=$('<div class="map_it_wrapper"></div>'),$(d.summary_container).append(d.map_it_wrapper),d.map_it=b.m.main.makeButton("MAP THIS PLACE"),$(d.map_it_wrapper).append(d.map_it),
$(d.map_it).addClass("text_only small bordered"),$(d.map_it).on("click",function(a){a.preventDefault();h.handleMapItClick()}))},handleMapItClick:function(){$("body").is(".bookmarklet")?a.place_id?b.m.pane_bookmarklet.PlacePicker.confirmPlaceId(a.place_id):a.name?$(d.map_it).is(".progress")||(b.m.main.Loading.onPosition($(d.map_it).offset(),d.map_it),b.m.pane_bookmarklet.PlacePicker.confirmNewPlace(a,function(a,c){b.m.main.Loading.offPosition();a&&(b.logE(a.stack),b.m.main.makeSignPost("Map had trouble creating that place."))})):
$(d.map_it).is(".progress")||(b.m.main.Loading.onPosition($(d.map_it).offset(),d.map_it),b.m.pane_bookmarklet.PlacePicker.confirmLatLngPlace(a,function(a,c){b.m.main.Loading.offPosition();a&&(b.logE(a.stack),b.m.main.makeSignPost("Map had trouble creating that place."))})):a.place_id?b.m.pane_uploads.PlacePicker.confirmPlaceId(a.place_id):a.name?$(d.map_it).is(".progress")||(b.m.main.Loading.onPosition($(d.map_it).offset(),d.map_it),b.m.pane_uploads.PlacePicker.confirmNewPlace(a,d.map_it_wrapper,
function(a,c){b.m.main.Loading.offPosition();a&&(b.logE(a.stack),b.m.main.makeSignPost("Map had trouble creating that place."))})):$(d.map_it).is(".progress")||(b.m.main.Loading.onPosition($(d.map_it).offset(),d.map_it),b.m.pane_uploads.PlacePicker.confirmLatLngPlace(a,d.marker_summary,function(a,c){b.m.main.Loading.offPosition();a&&(b.logE(a.stack),b.m.main.makeSignPost("Map had trouble creating that place."))}))}};k.hideSummary();d.marker_summary=$('<div class="marker_summary"></div>');d.close_control=
$('<div class="icon close_control"></div>');$(d.marker_summary).append(d.close_control);$(d.close_control).on("click",function(a){k.hideSummary()});d.summary_container=$('<div class="summary_container"></div>');$(d.marker_summary).append(d.summary_container);$(d.summary_container).append(b.m.main.makeEllipsisLoader());c.summary_pin_id=e;$(m).append(d.marker_summary);a.place_id&&"undefined"==typeof a.lat?b.m.data.Cache.read.place(a.place_id,function(a,c){if(a)return b.logE(a);if(c.null_result)return b.logE(Error("No place data."));
h.fillSummary(c)}):h.fillSummary(a)};k.hideLabel=function(){h&&h.hide()};k.hideSummary=function(){c.summary_pin_id=null;c.mouse_is_over_label=!1;$(m).find(".marker_summary").remove()};k.init=function(a){c.map=a;e();h=new f(c.label_zIndex);for(pin_set in c.pin_queue)for(a=c.pin_queue[pin_set];0!=a.length;){var k=a.pop();b.m.pane_map.createClusterMarker(k.place_data,k.pin_options)}};return k}();l.Places=function(){var b={},f={};b.init=function(){f=new google.maps.places.PlacesService(h.map)};b.getDetails=
function(b,c){f.getDetails({reference:b},function(b,a){a==google.maps.places.PlacesServiceStatus.OK?c(null,b):c(Error("Place detail lookup error: "+a))})};return b}();l.panBy=function(e,f){b.m.pane_map.doAfterMapLoad(function(){h.map.panBy(e,f)})};l.panZoomThenDropPin=function(e){b.m.pane_map.panTo(e.lat,e.lng,15,function(f,k){b.m.pane_map.dropAPin(e)})};l.panTo=function(e,f,k,c){b.m.pane_map.doAfterMapLoad(function(){var l=new google.maps.LatLng(e,f);if(k){h.map.setZoom(k);if(c){var a=!1;r.setNextCallback(function(b,
d){a||(a=!0,c(b,d))});setTimeout(function(){a||(a=!0,c(e,f))},500)}h.map.panTo(l)}else if(h.zoom_changed||h.center_changed){var m=h.map.getBounds();m&&!m.contains(l)&&h.map.panTo(l)}else b.m.pane_map.zoomInToDefault(),h.map.panTo(l)})};l.resize=function(){q()&&google.maps.event.trigger(h.map,"resize")};l.setCenter=function(e,f){b.m.pane_map.doAfterMapLoad(function(){var b=new google.maps.LatLng(e,f);h.map.setCenter(b)})};l.setOptions=function(b){h.map.setOptions(b)};l.setZoom=function(e){"number"==
typeof e&&b.m.pane_map.doAfterMapLoad(function(){h.map.setZoom(e)})};l.show=function(){$("body").is(".hide_map")&&$("body").removeClass("hide_map")};l.showMarker=function(e,f){if(e.lat&&e.lng){f||(f={});if(f.panby&&"undefined"!=typeof f.panby.x&&"undefined"!=typeof f.panby.y){var k=!1,c=function(){k||(google.maps.event.removeListener(l),k=!0,b.m.pane_map.panBy(f.panby.x,f.panby.y))},l=google.maps.event.addListener(h.map,"idle",function(){c()});setTimeout(function(){c()},500)}b.m.pane_map.expand();
b.m.pane_map.setCenter(e.lat,e.lng);b.m.pane_map.createMarker(e,f);b.m.pane_map.zoomInToDefault()}};l.showMarkersForLoggedInUser=function(e){e||(e={});b.m.main.doAfterAuth({logged_in:function(){var f=b.logged_in_user.user_id;b.m.pane_map.clearLoggedInUserMarkers();b.m.data.Cache.read.user_place_ids(f,function(k,c){if(k)return b.logE(k);for(var h=0;h<c.length;h++)b.m.pane_map.createClusterMarker({place_id:c[h]},{target_user_id:f,logged_in_user_marker:f});b.state.user_id_in_context==f&&e.fit_bounds&&
b.m.pane_map.fitBoundsToPlaceIds(c)})}})};l.showMarkersForUser=function(e,f){f||(f={});var h={show:function(){b.m.pane_map.clearUserMarkers();b.m.data.Cache.read.user_place_ids(e,function(c,h){if(c)return b.logE(c);for(var a=0;a<h.length;a++)b.m.pane_map.createClusterMarker({place_id:h[a]},{target_user_id:e,user_marker:e});f.fit_bounds&&b.m.pane_map.fitBoundsToPlaceIds(h)})}};b.m.main.doAfterAuth({logged_in:function(){b.logged_in_user.user_id!=e&&h.show()},not_authorized:function(){h.show()}})};l.zoomInToDefault=
function(){b.m.pane_map.doAfterMapLoad(function(){h.map.getZoom()<h.ideal_zoom&&h.map.setZoom(h.ideal_zoom)})};return l}()});
