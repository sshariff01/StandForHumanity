octoplace_com.m.pane_intro=function(){function n(b){var d={},a={pane:b,footer_section:$(b).find(".footer_section").first()},f=[];d.addCTAButton=function(a,b){var e=c.m.main.makeButton("VIEW MAP");$(e).addClass("text_only bordered state_trigger");if(-1!=b.search(c.m.shared.RegExp.hashtag)){var d=c.m.shared.PathApp(["hashtags",b.slice(1)]);$(e).attr("href",d)}else-1!=b.search(c.m.shared.RegExp.atmention)?(d=b.slice(1),$(e).attr("href","/"+d)):(d=c.m.shared.PathApp(["sources",b]),$(e).attr("href",d));
$(a).append(e);$(e).one("click.analytics",function(c){ga("send","event","Button","Click","Home-Featured-ViewMap-"+b)})};d.addHeadingLink=function(b,a){var e=$('<a class="state_trigger heading_link"></a>');if(-1!=a.search(c.m.shared.RegExp.hashtag)){$(e).append(a);var d=c.m.shared.PathApp(["hashtags",a.slice(1)]);$(e).attr("href",d)}else-1!=a.search(c.m.shared.RegExp.atmention)?($(e).append(a),d=a.slice(1),$(e).attr("href","/"+d),c.m.data.Cache.read.username(d,function(b,d){if(b)return c.logE(b);if(d.null_result)return c.logE(Error("Username not found."));
var k=d.user_id,f=$('<a class="profile_pic_link state_trigger"></a>');$(e).before(f);$(f).attr("href",c.m.shared.PathApp(["users",k]));$(f).append(c.m.main.ProfilePic.thumbnail(k));$(f).one("click.analytics",function(c){ga("send","event","Button","Click","Home-Featured-ProfilePicLink-"+a)})})):(d=c.m.shared.PathApp(["sources",a]),$(e).attr("href",d),c.m.data.Cache.read.source(a,function(a,b){if(a)return c.logE(a);$(e).append(b.name||c.m.shared.getSourceParts(b.url).name)}));$(b).append(e);$(e).one("click.analytics",
function(c){ga("send","event","Button","Click","Home-Featured-HeadingLink-"+a)})};d.addPic=function(a,b){var d=c.m.main.makePlaceCardForPic(b,{omit_comments:!0,omit_hashtags:!0});$(a).append(d.ui.card_container);d.fail(function(a){$(d.ui.card_container).remove();d.ui.card_container=null;c.logE(a)});d.done(function(a){a=a.place;c.m.pane_map.createClusterMarker(a);f.push(a)})};d.addSet=function(b){var f=$('<div class="featured_set"></div>'),e=$('<div class="heading"></div>');$(f).append(e);d.addHeadingLink(e,
b.thing);e=$('<div class="subheading"></div>');$(f).append(e);$(e).append(b.description);e=$('<div class="cta"></div>');$(f).append(e);d.addCTAButton(e,b.thing);e=$('<div class="pics"></div>');$(f).append(e);b=b.pics.split(",");for(var l=[],g=0;g<b.length;g++){var p=b[g].replace(/\s/g,"");c.m.shared.parseId(p).pic_id&&l.push(p)}for(g=0;g<l.length;g++)d.addPic(e,l[g]);$(a.featured).append(f)};d.getPlaceMarkers=function(){return f};a.featured=$('<div class="featured_section"></div>');$(a.featured).data("fn",
d);$(a.footer_section).before(a.featured);c.m.pane_map.formatForHomePage(a.featured);a.intro=$('<div class="featured_intro"></div>');$(a.featured).append(a.intro);$(a.intro).append('<div class="heading">For people who ask, "Where?"</div>');$(a.intro).append('<div class="subheading">Everyone has a different journey. Follow those that inspire you.</div>');$(a.intro).append('<div class="next"><div class="label">FEATURED MAPS</div><div class="icon"></div></div>');c.m.data.GET(["home-page-featured"],function(a){if(200!=
a.code)return console.error(Error(a.message).stack);for(var b=0;b<a.data.length;b++){var c=a.data[b];c.thing&&c.description&&c.pics&&d.addSet(c)}});ga("send","event","Page","View","Home-NotLoggedIn");$(".signup_button").one("click.analytics",function(a){ga("send","event","Button","Click","Home-SignUp")})}function s(){var b,d;b=$(c.panels.content).find(".pane."+h).first();0==b.length?b=q():$(b).empty();d=c.m.main.Paginator.create();$(b).append(d);c.m.main.loadModules(["pane_users"],function(){t(b,
c.logged_in_user.user_id)});r()}function u(){var b=$(c.panels.content).find(".pane."+h).first();0==b.length?(b=q(),$(b).load(c.fragment_path+"fragment_site_intro.html",function(){n(b)})):n(b);c.m.pane_map.hide()}function q(){c.m.main.loadCss(h);var b=$('<div class="panes"></div>');$(c.panels.content).append(b);var d=c.m.main.makePane(h);$(b).append(d);return d}function t(b,d){var a={pane:b},f={},k={},h=!1,e=1,l=[],g=[];f.add=function(b,e){f.setMapCenter(e);var g=c.m.pane_users.showFollowingPlaceCard(a.places,
d,b,e).done(function(a){if(a.pic&&a.pic.pic_id){if(k[a.pic.pic_id]){$(g.ui.card_container).remove();return}k[a.pic.pic_id]=!0}else if(a.tidbit&&a.tidbit.creator&&a.tidbit.tidbit_id){var b=a.tidbit.creator+a.tidbit.tidbit_id;if(k[b]){$(g.ui.card_container).remove();return}k[b]=!0}var b={place_id:e},d={};a.target_path&&(d.target_path=a.target_path,b.target_path=a.target_path);c.m.pane_map.createClusterMarker({place_id:e},d);l.push(b)}).fail(function(a){c.logW(a);$(g.ui.card_container).remove()})};f.getPlaceMarkers=
function(){return l};f.setMapCenter=function(a){h||(h=!0,a=c.m.shared.getLatLngFromPlaceId(a),c.m.pane_map.setCenter(a.lat,a.lng))};f.fetch=function(){c.m.data.GET(["users",d,"atfollowing-places-recent"],{per_page:12,page:e},function(a){if(200!=a.code)c.m.main.makeSignPost("Looks like there was a problem loading your feed. Please try refreshing. Email "+c.m.shared.help_email+" if the problem persists."),c.logE(Error(a.message));else{a=a.data.user_places_recent;for(var b=0;b<a.length;b++){var d=a[b];
-1==g.indexOf(d)&&(g.push(d),d=d.split("/"),f.add(d[0],d[1]))}b=c.m.main.Paginator.get();12==a.length?(e++,$(window).trigger("scroll"),$(b).data("fn").setPaginate(function(){f.fetch()})):$(b).data("fn").endPagination()}})};a.header=$('<div class="feed_header"></div>');$(a.pane).prepend(a.header);a.heading=$('<div class="heading">Your Feed</div>');$(a.header).append(a.heading);a.subheading=$('<div class="subheading">Get inspired by our </div>');$(a.header).append(a.subheading);a.tb_link=$('<a class="state_trigger text_link">#trailblazers</a>');
$(a.tb_link).attr("href",c.m.shared.PathApp(["users","FWGjaRk2Ij0","hashtags","trailblazers"]));$(a.tb_link).one("click.analytics",function(){ga("send","event","Button","Click","Home-Feed-Header-Trailblazers")});$(a.subheading).append(a.tb_link);$(a.subheading).append(". Contribute to our ");a.hashtag_link=$('<a class="state_trigger text_link">hashtags</a>');$(a.hashtag_link).attr("href",c.m.shared.PathApp(["users","FWGjaRk2Ij0","hashtags"]));$(a.hashtag_link).one("click.analytics",function(){ga("send",
"event","Button","Click","Home-Feed-Header-Hashtags")});$(a.subheading).append(a.hashtag_link);$(a.subheading).append(" and get featured!");a.feed=$('<div class="feed"></div>');$(a.header).after(a.feed);$(a.feed).data("fn",f);a.places=$('<div class="places"></div>');$(a.feed).append(a.places);f.fetch()}function r(){c.m.pane_map.show();c.m.pane_map.clearOtherMarkers();c.m.pane_map.clearFocusMarkers();var b=c.m.main.Paginator.get();b&&c.m.main.Scroll.setPaginate($(b).data("fn").paginate);c.m.pane_map.showMarkersForLoggedInUser()}
var c=octoplace_com,m={},h="pane_intro";m.create=function(){c.m.main.doAfterAuth({logged_in:function(){s()},not_authorized:function(){u()}})};m.wake=function(){c.m.main.doAfterAuth({logged_in:function(){r();var b;b=$(c.panels.content).find(".pane."+h).first().find(".feed").first();if(0<b.length&&$(b).data("fn")){b=$(b).data("fn").getPlaceMarkers();for(var d=0;d<b.length;d++){var a=b[d],f={};a.target_path&&(f.target_path=a.target_path);c.m.pane_map.createClusterMarker({place_id:a.place_id},f)}}},not_authorized:function(){var b=
$(c.panels.content).find(".featured_section").first();0<b.length&&(c.m.pane_map.hide(),c.m.pane_map.formatForHomePage(b));b=$(c.panels.content).find(".featured_section").first();if(0<b.length&&$(b).data("fn"))for(var b=$(b).data("fn").getPlaceMarkers(),d=0;d<b.length;d++)c.m.pane_map.createClusterMarker(b[d])}})};return m}();
