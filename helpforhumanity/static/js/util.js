octoplace_com.m.util=function(){function q(a,b){var c=document.createElement("img");$(c).addClass("block_image");var d=l[b];d?!0==d.valid?(c.src=b,d.width&&$(c).width(d.width),d.height&&$(c).height(d.height),$(a).replaceWith(c)):!1==d.valid&&$(a).after(" (404)"):(l[b]={},c.src=b,$(c).on("load",function(c){$(a).replaceWith(this);var d=l[b];d.width=$(c.target).width();d.height=$(c.target).height();d.valid=!0}),$(c).on("error",function(c){l[b].valid=!1;$(a).after(" (404)")}))}var g=octoplace_com,e={},
l={},r=0,m="body";(function(){var a=$("<div></div>");$(a).css({position:"absolute",top:"0px",left:"0px",height:2*$(window).height()+"px",width:"1px"});$("body").append(a);$(window).scrollTop(1);1==$("html").scrollTop()&&(m="html");$(window).scrollTop(0);$(a).remove()})();var h,n,k,p;h=function(a,b){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(b));if(-1==c)throw"Cannot decode base64";return c};n=function(a){a=""+a;var b,c,d,f=a.length;if(0==f)return a;if(0!=
f%4)throw"Cannot decode base64";b=0;"="==a.charAt(f-1)&&(b=1,"="==a.charAt(f-2)&&(b=2),f-=4);var e=[];for(c=0;c<f;c+=4)d=h(a,c)<<18|h(a,c+1)<<12|h(a,c+2)<<6|h(a,c+3),e.push(String.fromCharCode(d>>16,d>>8&255,d&255));switch(b){case 1:d=h(a,c)<<18|h(a,c+1)<<12|h(a,c+2)<<6;e.push(String.fromCharCode(d>>16,d>>8&255));break;case 2:d=h(a,c)<<18|h(a,c+1)<<12,e.push(String.fromCharCode(d>>16))}return e.join("")};k=function(a,b){var c=a.charCodeAt(b);if(255<c)throw"INVALID_CHARACTER_ERR: DOM Exception 5";
return c};p=function(a){if(1!=arguments.length)throw"SyntaxError: Not enough arguments";var b,c,d=[];a=""+a;var f=a.length-a.length%3;if(0==a.length)return a;for(b=0;b<f;b+=3)c=k(a,b)<<16|k(a,b+1)<<8|k(a,b+2),d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>18)),d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>12&63)),d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>6&63)),d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c&
63));switch(a.length-f){case 1:c=k(a,b)<<16;d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>18)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>12&63)+"==");break;case 2:c=k(a,b)<<16|k(a,b+1)<<8,d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>18)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>
6&63)+"=")}return d.join("")};window.btoa||(window.btoa=p);window.atob||(window.atob=n);e.boldSearchWords=function(a,b){var c=a,d=b.join(" "),d=RegExp(g.m.shared.RegExpEsc(d),"i"),d=c.replace(d,function(a){return'<span class="query_text_match">'+a+"</span>"});if(d.length>c.length)return d;for(var f=!1,d=0;d<b.length;d++){var e=b[d];if(1<e.length&&(e=RegExp(g.m.shared.RegExpEsc(e),"i"),c=c.replace(e,function(a){f=!0;return'<span class="query_text_match">'+a+"</span>"}),f))break}return c};e.convertImageMarkupToHTML=
function(a){$(a).find("a").not(".custom").each(function(){var a=$(this).attr("href");(0==a.slice(-4).search(/(\.png|\.gif|\.jpg)/i)||0==a.slice(-5).search(/(\.jpeg)/i)||$(this).hasClass("image"))&&q(this,a)})};e.convertTextToSlug=function(a){return"string"!=typeof a?"":a.replace(/[^0-9a-z\- ]/gi,"").replace(/[\s]+/g,"-")};e.Cookie=function(){function a(a,c,d){var f="";d&&(f=new Date,f.setTime(f.getTime()+864E5*d),f="; expires="+f.toGMTString());document.cookie=a+"="+c+f+"; path=/"}return{create:a,
read:function(a){a+="=";for(var c=document.cookie.split(";"),d=0;d<c.length;d++){for(var f=c[d];" "==f.charAt(0);)f=f.substring(1,f.length);if(0==f.indexOf(a))return f.substring(a.length,f.length)}return null},remove:function(b){a(b,"",-1)}}}();e.elementInView=function(a,b,c){b||(b=1);c||(c=0);var d=!1,f=!1,e=$(a).outerHeight()+parseInt($(a).css("margin-top"))+parseInt($(a).css("margin-bottom")),g=$(window).scrollTop();b=g+$(window).height()*b;0<c&&(g-=$(window).height()*c);c=$(a).offset().top-parseInt($(a).css("margin-top"));
var h=c+e;(c>g||h>g)&&c<b&&(d=!0);var k=$(window).width(),l=$(a).offset().left;a=l+$(a).outerWidth()+parseInt($(a).css("margin-left"))+parseInt($(a).css("margin-right"));(0<l||0<a)&&l<k&&(f=!0);return d&&f?c>=g?h<=b?1:e<$(window).height()?3:4:2:!1};e.flashHighlight=function(a){var b=a.css("background-color");a.addClass("gpu");a.css("background-color","rgba(231, 247, 132, 1)");var c=1,d=setInterval(function(){c=(c-0.01).toFixed(2);0>=c?("rgba(0, 0, 0, 0)"==b||"transparent"==b?a.css("background-color",
""):a.css("background-color",b),a.removeClass("gpu"),clearInterval(d)):a.css("background-color","rgba(231, 247, 132, "+c+")")},5)};e.generateUniqueId=function(){return"octoplace_com_uid_"+r++};e.getBackgroundImageUrl=function(a){a=/url\(['"]?([^")]+)/.exec(a)||[];return(a=a[1])?a:!1};e.getImageDimensions=function(a,b){var c={},d={};c.cleanUp=function(){$(d.img_loader).remove()};d.img_loader=document.createElement("img");$(d.img_loader).css({position:"absolute",display:"block",left:"-99999px",top:"0px"});
$(d.img_loader).one("load",function(){var a={height:d.img_loader.height,width:d.img_loader.width};$(d.img_loader).remove();b(null,a);c.cleanUp()});$(d.img_loader).one("error",function(){b(Error("Unable to load image"));c.cleanUp()});$("body").append(d.img_loader);$(d.img_loader).attr("src",a)};e.getEventPosition=function(a){var b=0,c=0;if(a.pageX||a.pageY)b=a.pageX,c=a.pageY;else if(a.clientX||a.clientY)b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+
document.documentElement.scrollTop;return{x:b,y:c}};e.getScrollable=function(){return m};e.humanizeDate=function(a){var b=new Date(parseInt(a)),c=new Date,d="Sun Mon Tue Wed Thu Fri Sat".split(" "),f="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");if(c.getFullYear()==b.getFullYear()){if(6048E5>c-b){if(c.getDay()==b.getDay())return e.humanizeTime(a);c=c.getDay()-b.getDay();return 1==c||-6==c?"Yesterday at "+e.humanizeTime(a):d[b.getDay()]+" at "+e.humanizeTime(a)}return d[b.getDay()]+
", "+f[b.getMonth()]+" "+b.getDate()+" at "+e.humanizeTime(a)}return d[b.getDay()]+", "+f[b.getMonth()]+" "+b.getDate()+", "+b.getFullYear()+" at "+e.humanizeTime(a)};e.humanizeNumber=function(a){"string"==typeof a&&(a=parseInt(a));return 1E7<=Math.abs(a)?Math.floor(a/1E6)+"M":1E6<=Math.abs(a)?(a/1E6).toString().slice(0,3)+"M":1E4<=Math.abs(a)?Math.floor(a/1E3)+"K":1E3<=Math.abs(a)?(a/1E3).toString().slice(0,3)+"K":a.toString()};e.humanizeTime=function(a){var b=new Date(parseInt(a));a=b.getMinutes();
var b=b.getHours(),c=a.toString();10>a&&(c="0"+c);return 12==b?"12:"+c+"pm":0==b?"12:"+c+"am":12<b?b-12+":"+c+"pm":b+":"+c+"am"};e.humanizeUA=function(a){if("string"!=typeof a)return"";var b={mac:"Macintosh",win:"Windows",android:"Android",ipad:"iPad",iphone:"iPhone",ipod:"iPod"},c={ff:"Firefox",ie:"MSIE",safari:"Safari"},d="";for(key in b)if(-1!=a.search(b[key])){d+=b[key]+" ";break}if(-1!=a.search("Chrome"))d+="Chrome ";else for(key in c)if(-1!=a.search(c[key])){d+=c[key]+" ";break}return d||a};
e.linkAtMentions=function(a){$(a).find("a.atmention").each(function(){$(this).addClass("state_trigger");var a=$(this).text().slice(1).toLowerCase();$(this).attr("href",g.m.shared.PathUsername([a]));$(this).attr("target","_blank")})};e.linkHashTags=function(a,b){"undefined"==typeof b&&(b={});$(a).find("a.hashtag").each(function(){$(this).addClass("state_trigger");var a=$(this).text().slice(1).toLowerCase();b.target_user_id?$(this).attr("href",g.m.shared.PathApp(["users",b.target_user_id,"hashtags",
a])):$(this).attr("href",g.m.shared.PathApp(["hashtags",a,"pics"]));$(this).attr("target","_blank")})};e.makeGoogleMapsURL=function(a){if(!a)return"";if(a.lat&&a.lng)return"http://maps.google.com/maps?q="+a.lat+","+a.lng;if(a.address){var b="";try{b=encodeURI(a.address)}catch(c){return g.logE(c),""}return"http://maps.google.com/maps?q="+b.replace(/%20/g,"+")}return""};e.Promise=function(){var a=void 0,b=void 0,c=void 0,d=void 0,f={done:function(a){c=a;"undefined"!=typeof d&&c(d);return f},resolve:function(a){d=
a||{};"function"==typeof c&&c(d);return f},fail:function(c){a=c;"undefined"!=typeof b&&a(b);return f},reject:function(c){b=c||{};"function"==typeof a&&a(b);return f}};return f};e.prettyUrl=function(a){var b="";a=$('<a href="'+a+'"></a>')[0];b+=a.hostname;a=a.pathname.split("/").slice(-1);""!=a&&(b+="&hellip;"+a);return b};e.relativizeTime=function(a){a=new Date(parseInt(a));a=new Date-a;return 31536E6>a?864E5>a?36E5>a?(a=Math.floor(a/6E4),0>=a?"<1m":a+"m"):Math.floor(a/36E5)+"h":Math.floor(a/864E5)+
"d":Math.floor(a/31536E6)+"y"};e.replaceNoteLinks=function(a){$(a).find("a").each(function(){var a=$('<span class="replaced_link"></span>');$(a).append($(this).text());$(this).replaceWith(a)})};e.scaleElement=function(a,b){b=b.toFixed(3);var c="scale("+b+","+b+")";$(a).css({transform:c,WebkitTransform:c,MsTransform:c,OTransform:c,MozTransform:c})};e.setIntersect=function(a,b){if(!a||!b)return[];for(var c=[],d=0;d<a.length;d++)for(var f=a[d],e=0;e<b.length;e++)if(f==b[e]){c.push(f);break}return c};
e.shortenUrls=function(a,b){b||(b=50);$(a).find("a.url").each(function(){$(this)[0].hostname!=g.m.shared.site_hostname||$(this)[0].search||$(this)[0].hash||($(this).addClass("state_trigger"),$(this).attr("href",$(this)[0].pathname));var a=$(this).text();a.length>b&&$(this).empty().append(a.slice(0,b)+"&hellip;")})};e.smoothScroll=function(a,b){"undefined"==typeof b&&(b={});var c=b.duration;"undefined"==typeof c&&(c=400);var d=a;"object"==typeof d&&(d=$(a).offset().top-parseInt($(a).css("margin-top")));
var f=b.scrollable||e.getScrollable();$(f).animate({scrollTop:d},c,function(){"function"==typeof b.callback&&b.callback()})};e.smoothScrollIntoView=function(a,b){"undefined"==typeof b&&(b={});var c=b.scrollable||window,d=$(a).offset().top;b.scrollable&&(d+=$(c).scrollTop()-$(c).offset().top);var f=e.elementInView(a);2==f?e.smoothScroll(d,b):3==f?(c=$(c).height()-$(a).outerHeight(),e.smoothScroll(d-c,b)):4==f?e.smoothScroll(d,b):1==f?"function"==typeof b.callback&&b.callback():d<$(c).scrollTop()?e.smoothScroll(d,
b):$(a).outerHeight()>$(c).height()?e.smoothScroll(d,b):(c=$(c).height()-$(a).outerHeight(),e.smoothScroll(d-c,b))};e.sniffPlatform=function(){$("body").addClass("mouse_and_keyboard");if(localStorage.getItem("octoplace_com_touch_enabled"))$("body").addClass("touch_enabled"),$("body").removeClass("mouse_and_keyboard");else $(document).one("touchstart.initial_test",function(){try{localStorage.setItem("octoplace_com_touch_enabled",1)}catch(a){g.logE(a)}$("body").addClass("touch_enabled");$("body").removeClass("mouse_and_keyboard")});
var a,b;-1!=navigator.userAgent.search("Safari")&&(a="browser_safari");-1!=navigator.userAgent.search("Chrome")?a="browser_chrome":-1!=navigator.userAgent.search("Firefox")?a="browser_firefox":-1!=navigator.userAgent.search("MSIE")?a="browser_ie":-1!=navigator.userAgent.search("Trident/")&&(a="browser_ie");-1!=navigator.platform.search("Mac")?b="os_mac":-1!=navigator.platform.search("Win")?b="os_windows":-1!=navigator.platform.search("iPad")?b="os_ios":-1!=navigator.platform.search("iPhone")&&(b=
"os_ios");a&&$("body").addClass(a);b&&$("body").addClass(b)};e.supports=function(a){if("history"==a)return!(!window.history||!history.pushState);if("localStorage"==a)try{return localStorage.setItem("supportsLocalStorage","yes"),localStorage.removeItem("supportsLocalStorage"),!0}catch(b){}return!1};e.upgradeLinks=function(a){var b={upgradeLink:function(a){var b=$(a).html().replace(/^https?:\/\//,"");$(a).empty().append(b)},upgradePic:function(a,b){var f=g.m.main.makePicThumb(b,function(b,d){b||$(a).replaceWith(f)})},
upgradePlace:function(a,b){g.m.data.Cache.read.place(b,function(b,d){if(b)return g.logE(b);if(d.null_result)return g.logE(Error("No place data."));d.name&&$(a).empty().append(g.m.shared.prettyPlaceNameHTML(d))})},upgrade:function(a){g.m.main.Path.parse(a.pathname,function(d,f){if(d)return g.logE(d);if(f.name==g.m.shared.Route.pics().slice(1)){var e=f.domain;e&&!f.filter&&b.upgradePic(a,e)}else f.name==g.m.shared.Route.places().slice(1)?(e=f.domain)&&!f.filter&&b.upgradePlace(a,e):f.name==g.m.shared.Route.users().slice(1)&&
f.filter==g.m.shared.Route.places().slice(1)&&f.filter_domain&&(e=f.filter_domain,b.upgradePlace(a,e))})}};$(a).find("a.url.state_trigger").each(function(){b.upgrade(this)});$(a).find("a.url").not(".state_trigger").each(function(){b.upgradeLink(this)})};return e}();
