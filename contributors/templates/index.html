<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Stand For Humanity</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        {% load staticfiles %}

        <!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

        <link rel="stylesheet" href={% static 'css/main.css' %}>

        <script>window.jQuery || document.write("<script src={% static 'js/vendor/jquery-2.1.1.min.js' %}><\/script>")</script>

        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
        <script>
            function initialize() {
              // Create an array of styles.
              var styles = [
                {
                  stylers: [
                    { "gamma": 0.69 },
                    { "visibility": "simplified" },
                    { "lightness": -66 },
                    { "saturation": -6 },
                    { "hue": "#00bbff" }
                  ]
{#                },{#}
{#                  featureType: "road",#}
{#                  elementType: "geometry",#}
{#                  stylers: [#}
{#                    { hue: "#010b17" },#}
{#                    { lightness: 0 },#}
{#                    { visibility: "simplified" }#}
{#                  ]#}
{#                },{#}
{#                  featureType: "road",#}
{#                  elementType: "labels",#}
{#                  stylers: [#}
{#                    { hue: "#010b17" },#}
{#                    { visibility: "off" }#}
{#                  ]#}
                }
              ];

              // Create a new StyledMapType object, passing it the array of styles,
              // as well as the name to be displayed on the map type control.
              var styledMap = new google.maps.StyledMapType(styles,
                {name: "Styled Map"});

              // Create a map object, and include the MapTypeId to add
              // to the map type control.
              var mapOptions = {
                zoom: 3,
                center: new google.maps.LatLng(55.6468, 37.581),
                mapTypeControlOptions: {
                  mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
                }
              };


              // Try W3C Geolocation (Preferred)
              if(navigator.geolocation) {
                browserSupportFlag = true;
                navigator.geolocation.getCurrentPosition(function(position) {
                  initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
                  map.setCenter(initialLocation);
                }, function() {
                  handleNoGeolocation(browserSupportFlag);
                });
              }
              // Browser doesn't support Geolocation
              else {
                browserSupportFlag = false;
                handleNoGeolocation(browserSupportFlag);
              }

              function handleNoGeolocation(errorFlag) {
                if (errorFlag == true) {
                  alert("Geolocation service failed.");
                  initialLocation = newyork;
                } else {
                  alert("Your browser doesn't support geolocation. We've placed you in Siberia.");
                  initialLocation = siberia;
                }
                map.setCenter(initialLocation);
              }

              var map = new google.maps.Map(document.getElementById('map-canvas'),
                mapOptions);

              //Associate the styled map with the MapTypeId and set it to display.
              map.mapTypes.set('map_style', styledMap);
              map.setMapTypeId('map_style');
            }

            google.maps.event.addDomListener(window, 'load', initialize);
        </script>

        <script>
          function loginUser() {
              FB.login(
                  function(response) {
                      checkLoginState(); //This is a call to a different function...
                  },
                {scope:'user_likes, offline_access'}
              );
          }

          function logoutUser() {
              FB.logout(function(response) {
                // user is now logged out
                location.reload();
              });
          }
          // This is called with the results from from FB.getLoginStatus().
          function statusChangeCallback(response) {
            console.log('statusChangeCallback');
            console.log(response);
            // The response object is returned with a status field that lets the
            // app know the current login status of the person.
            // Full docs on the response object can be found in the documentation
            // for FB.getLoginStatus().
            if (response.status === 'connected') {
              // Logged into your app and Facebook.
              testAPI();
            } else if (response.status === 'not_authorized') {
              // The person is logged into Facebook, but not your app.
{#              document.getElementById('status').innerHTML = 'Please log ' +#}
{#                'into this app.';#}
            } else {
              // The person is not logged into Facebook, so we're not sure if
              // they are logged into this app or not.
{#              document.getElementById('status').innerHTML = 'Please log ' +#}
{#                'into Facebook.';#}
            }
          }

          // This function is called when someone finishes with the Login
          // Button.  See the onlogin handler attached to it in the sample
          // code below.
          function checkLoginState() {
            FB.getLoginStatus(function(response) {
              statusChangeCallback(response);
            });
          }

          window.fbAsyncInit = function() {
          FB.init({
            appId      : '1437376213194117',
            cookie     : true,  // enable cookies to allow the server to access
                                // the session
            xfbml      : true,  // parse social plugins on this page
            version    : 'v2.0' // use version 2.0
          });

          // Now that we've initialized the JavaScript SDK, we call
          // FB.getLoginStatus().  This function gets the state of the
          // person visiting this page and can return one of three states to
          // the callback you provide.  They can be:
          //
          // 1. Logged into your app ('connected')
          // 2. Logged into Facebook, but not your app ('not_authorized')
          // 3. Not logged into Facebook and can't tell if they are logged into
          //    your app or not.
          //
          // These three cases are handled in the callback function.

          FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
          });

          };

          // Load the SDK asynchronously
          (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));

          // Here we run a very simple test of the Graph API after login is
          // successful.  See statusChangeCallback() for when this call is made.
          function testAPI() {
            console.log('Welcome!  Fetching your information.... ');
{#            var fbID = FB.getAuthResponse().userID#}
            FB.api('/me', function(response) {
              console.log('Successful login for: ' + response.name);
{#              document.getElementById('status').innerHTML = '';#}
              $('#login-with-facebook').css('display', 'none');
              $('#facebook-image').append("<a class='facebook-img' href='#' onclick='dropdownOptions();'>" +
                      "<img src='https://graph.facebook.com/v2.0/"+FB.getAuthResponse().userID+"/picture' width='35' style='border-radius: 15px;'></img>" +
                      "</a>");

            });
          }
        </script>

        <script>
            function dropdownOptions() {
                var dropdown = $('.dropdown');
                if (dropdown.css('display') !== 'none') {
                    dropdown.css('display', 'none');
                } else {
                    dropdown.css('display', 'block');
                }
            }
        </script>
    </head>
    <style>

        .dropdown {
            width: 75px;
            padding-top: 10px;
            z-index: 100;
            position: absolute;
            display: none;
        }

        .dropdown ul,li {
            list-style-type: none;
            list-style-position: inside;
            padding: 5px 0 5px 0;
            font-size: 13px;
            background: lightgray;
            color: black;
            font-weight: 300;
        }

        .dropdown-list a:hover {
            background-color: #30bdff;
        }

    </style>
    <body>
        <div class="header-container" >
            <div id="header" >
                <div id="table-container">
                    <table style="width: 100%;" id="header-table">
                        <tr>
                            <td>
                               <div style="float:left;">
                                   <a href="#"><img id="iconImg" src={% static 'img/standforhumanity.png' %} width="300" /></a>
                               </div>
                            </td>
                            <div style="float:right;">
                            <td class="header-tab">
                                <a class="tab-link" href="#map">Map</a>
                            </td>
                            <td class="header-tab">
                                <a class="tab-link" href="#thecause">The Cause</a>
                            </td>
                            <td class="header-tab">
                                <a class="tab-link" href="#about">About</a>
                            </td>
                            <td class="header-tab">
                                <a class="tab-link" href="#theimpact">The Impact</a>
                            </td>
                            <td width="75" class="header-tab">
{#                                <a class="tab-link" href="#">Login</a>#}
                                <div id="login-with-facebook">
                                    <a class="tab-link" href="#" onClick="loginUser(); return false;">Login</a>
                                </div>
                                <div id="facebook-image"></div>
                                <div class="dropdown">
                                    <ul class="dropdown-list">
                                        <a href="#" onclick="logoutUser(); return false;"><li>Logout</li></a>
                                    </ul>
                                </div>
                            </td>
                            </div>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div class="main-container">
            <div class="tagline-container">
                <h1 class="tagline">What if you and your friends could make difference?</h1>
                <h4 class="subtag1">Support the cause and join hundreds of others to take a stand for humanity.</h4>
                <h4 class="subtag2">We're creating a movement.</h4>
            </div>
            <div class="map-container">
                <div id="map-canvas"></div>
            </div>
        </div>
    </body>
</html>